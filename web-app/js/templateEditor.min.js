var formOpened=false;var currentSort=null;function userMessage(a){alert(a)}function editFields(a){$("#templateSelect").val(a);$("#templateChoice").submit()}function editTemplate(d){if(!formOpened){formOpened=true;$("#template_"+d+"_form").show();$("#templates li:not(#template_"+d+")").addClass("ui-state-disabled");var a=$("#template_"+d+"_form").parent();var c=a.offset().top+a.height();var b=10;if(c>$(document).scrollTop()+$(window).height()){$("html, body").animate({scrollTop:c+b-$(window).height()},200)}if(d!="new"&&d!="requestTemplate"){$("#addNew").addClass("ui-state-disabled")}}}function hideTemplateForm(a){$("#template_"+a+"_form").hide();$("#templates li:not(#template_"+a+")").removeClass("ui-state-disabled");$("#addNew").removeClass("ui-state-disabled");formOpened=false}function clearTemplateForm(a){$("#template_"+a+"_form input#name").val("");$("#template_"+a+"_form textarea").val("")}function clearTemplateRequestForm(a){$("#template_"+a+"_form input#rname").val("");$("#template_"+a+"_form textarea").val("")}function createTemplate(b){var a=$("#template_"+b+"_form");showWaiting();$.ajax({url:baseUrl+"/templateEditor/"+a.attr("action"),data:a.serialize(),dataType:"json",type:"POST",success:function(d,e,c){clearTemplateForm(b);hideTemplateForm(b);addTemplateListItem(d.id,d.html)},error:function(c){alert("Could not create template: "+c.responseText)},complete:function(c,d){hideWaiting();userMessage("Your template was created and added to the list.")}})}function updateTemplate(b){var a=$("#template_"+b+"_form");showWaiting();$.ajax({url:baseUrl+"/templateEditor/"+a.attr("action"),dataType:"json",data:a.serialize(),type:"POST",success:function(d,e,c){hideTemplateForm(b);updateTemplateListItem(b,d.html)},error:function(c){userMessage("Could not update template")},complete:function(c,d){hideWaiting();userMessage("Your template was updated.")}})}function deleteTemplate(a){showWaiting();$.ajax({url:baseUrl+"/templateEditor/deleteTemplate",data:"template="+a,type:"POST",success:function(c,d,b){deleteTemplateListItem(a);showHideEmpty("#templates")},error:function(b){alert("Could not delete template: "+b.responseText)},complete:function(b,c){hideWaiting();userMessage("Your template was deleted.")}});return true}function cloneTemplate(a){showWaiting();$.ajax({url:baseUrl+"/templateEditor/cloneTemplate/"+a,dataType:"json",type:"POST",success:function(c,d,b){addTemplateListItem(c.id,c.html)},error:function(b){alert("Could not clone template: "+b.responseText)},complete:function(b,c){hideWaiting();userMessage("A copy of your template has been created.")}})}function requestTemplate(b){var a=$("#template_"+b+"_form");showWaiting();$.ajax({url:baseUrl+"/templateEditor/"+a.attr("action"),data:a.serialize(),dataType:"json",type:"POST",success:function(d,e,c){clearTemplateRequestForm(b);hideTemplateForm(b)},error:function(c){alert("Could not create template: "+c.responseText)},complete:function(c,d){hideWaiting();alert("Your request has been sent to the templateadmin(s)")}})}function requestTemplateField(b){var a=$("#templateField_"+b+"_form");showWaiting();$.ajax({url:baseUrl+"/templateEditor/"+a.attr("action"),data:a.serialize(),dataType:"json",type:"POST",success:function(d,e,c){clearTemplateFieldRequestForm(b);hideTemplateFieldForm(b)},error:function(c){alert("Could not create template: "+c.responseText)},complete:function(c,d){hideWaiting();alert("Your request has been sent to the templateadmin(s)")}})}function addTemplateListItem(c,b){var a=$(b);$("#templates li:last").after(a);showHideEmpty("#templates")}function updateTemplateListItem(c,b){var a=$("#template_"+c);a.replaceWith(b)}function deleteTemplateListItem(b){var a=$("#template_"+b);a.remove();showHideEmpty("#templates")}function showTemplateFormEvent(a){showTemplateFieldForm(a.target.id)}function showTemplateFieldForm(c){if(!formOpened){formOpened=true;$("#templateField_"+c+"_form").show();$("#availableTemplateFields li:not(#templateField_"+c+")").addClass("ui-state-disabled");$("#selectedTemplateFields li:not(#templateField_"+c+")").addClass("ui-state-disabled");$("#disabledavailableTemplateFields li:not(#templateField_"+c+")").addClass("ui-state-disabled");$("#disabledselectedTemplateFields li:not(#templateField_"+c+")").addClass("ui-state-disabled");var a=$("#templateField_"+c+"_form").parent();var d=a.offset().top+a.height();var b=10;if(d>$(document).scrollTop()+$(window).height()){$("html, body").animate({scrollTop:d+b-$(window).height()},200)}if(c!="new"&&c!="requestTemplateField"){$("#addNew").addClass("ui-state-disabled")}}}function hideTemplateFieldForm(a){$("#templateField_"+a+"_form").hide();$("#availableTemplateFields li:not(#templateField_"+a+")").removeClass("ui-state-disabled");$("#selectedTemplateFields li:not(#templateField_"+a+")").removeClass("ui-state-disabled");$("#disabledavailableTemplateFields li:not(#templateField_"+a+")").removeClass("ui-state-disabled");$("#disabledselectedTemplateFields li:not(#templateField_"+a+")").removeClass("ui-state-disabled");$("#addNew").removeClass("ui-state-disabled");formOpened=false}function clearTemplateFieldForm(a){$("#templateField_"+a+"_form input[name=name]").val("");$("#templateField_"+a+"_form input[name=unit]").val("");$("#templateField_"+a+"_form input[name=required]").attr("checked","");$("#templateField_"+a+"_form textarea").val("");$("#templateField_"+a+"_form select").attr("selectedIndex",0);$("#templateField_"+a+"_form .extra").hide()}function clearTemplateFieldRequestForm(a){$("#templateField_"+a+"_form input[name=rname]").val("");$("#templateField_"+a+"_form textarea").val("");$("#templateField_"+a+"_form select").attr("selectedIndex",0)}function createTemplateField(c){var b=$("#templateField_"+c+"_form");var a=$("#templateSelect").val();showWaiting();$.ajax({url:baseUrl+"/templateEditor/"+b.attr("action"),data:"template="+a+"&"+b.serialize(),dataType:"json",type:"POST",success:function(e,f,d){clearTemplateFieldForm(c);hideTemplateFieldForm(c);addFieldListItem(e.id,e.html);userMessage("A new template field was created and can be added to your template.")},error:function(d){alert("Could not add template field: "+d.responseText)},complete:function(d,e){hideWaiting()}})}function updateTemplateField(b){var a=$("#templateField_"+b+"_form");showWaiting();$("#ontologies_"+b).children().attr("selected","selected");$.ajax({url:baseUrl+"/templateEditor/"+a.attr("action"),dataType:"json",data:a.serialize(),type:"POST",success:function(d,e,c){hideTemplateFieldForm(b);updateFieldListItem(b,d.html)},error:function(c){alert("Could not update template field: "+c.responseText)},complete:function(c,d){hideWaiting();userMessage("Your template field has been updated.")}})}function deleteTemplateField(a){showWaiting();$.ajax({url:baseUrl+"/templateEditor/deleteField",data:"templateField="+a,type:"POST",success:function(c,d,b){deleteFieldListItem(a);showHideEmpty("#availableTemplateFields")},error:function(b){alert("Could not delete template field: "+b.responseText)},complete:function(b,c){hideWaiting();userMessage("Your template field has been deleted.")}});return true}function updateTemplateFieldPosition(f,g){if(g.item.parent().attr("id")=="availableTemplateFields"||g.item.parent().attr("id")=="selectedTemplateFields"&&g.sender!=null&&g.sender.attr("id")=="availableTemplateFields"){return true}var c=g.item.index();var b=g.item.context.id;var e=b.substring(b.lastIndexOf("_")+1);var d=$("#templateSelect").val();var a=baseUrl+"/templateEditor/moveField";$("#templateFields").sortable("disable");showWaiting();$.ajax({url:a,data:"template="+d+"&templateField="+e+"&position="+c,dataType:"json",type:"POST",success:function(i,j,h){updateFieldListItem(e,i.html);$("#templateFields").sortable("enable")},error:function(h){undoMove();alert("Could not move template field: "+h.responseText)},complete:function(h,i){hideWaiting()}})}function addTemplateFieldEvent(c,d){var b=d.item.index();if($(".empty",d.item.parent()).index()<b){b--}var a=d.item.context.id;var e=a.substring(a.lastIndexOf("_")+1);return addTemplateField(e,b)}function addTemplateField(d,a,c){if(a==null){a=-1}if(c==null){c=false}var b=$("#templateSelect").val();showWaiting();$.ajax({url:baseUrl+"/templateEditor/addField",data:"template="+b+"&templateField="+d+"&position="+a,dataType:"json",type:"POST",success:function(f,g,e){updateFieldListItem(d,f.html);if(c){moveFieldListItem(d,"#selectedTemplateFields")}showHideEmpty("#selectedTemplateFields");showHideEmpty("#availableTemplateFields")},error:function(e){if(!c){undoMove()}alert("Could not add template field: "+e.responseText)},complete:function(e,f){hideWaiting()}});return true}function removeTemplateFieldEvent(b,c){var a=c.item.context.id;var d=a.substring(a.lastIndexOf("_")+1);return removeTemplateField(d)}function removeTemplateField(c,b){if(b==null){b=false}var a=$("#templateSelect").val();showWaiting();$.ajax({url:baseUrl+"/templateEditor/removeField",data:"template="+a+"&templateField="+c,type:"POST",success:function(e,f,d){updateFieldListItem(c,e.html);if(b){moveFieldListItem(c,"#availableTemplateFields")}showHideEmpty("#selectedTemplateFields");showHideEmpty("#availableTemplateFields")},error:function(d){if(!b){undoMove()}alert("Could not delete template field: "+d.responseText)},complete:function(d,e){hideWaiting()}});return true}function addFieldListItem(c,b){var a=$(b);$("#availableTemplateFields li:last").after(a);showHideEmpty("#availableTemplateFields")}function updateFieldListItem(c,b){var a=$("#templateField_"+c);a.replaceWith(b)}function deleteFieldListItem(b){var a=$("#templateField_"+b);a.remove();showHideEmpty("#availableTemplateFields")}function moveFieldListItem(c,b){var a=$("#templateField_"+c);a.remove();$(b).append(a)}function savePosition(a,b){currentSort={id:b.item.attr("id"),parent:b.item.context.parentNode,previous:b.item.context.previousElementSibling,index:b.item.index()}}function undoMove(){if(currentSort){var a=$("#"+currentSort.id);a.remove();if(currentSort.previous!=null){a.insertAfter(currentSort.previous)}else{$(currentSort.parent).append(a)}}}function showExtraFields(b){var a=$("#templateField_"+b+"_form select[name=type]").val();$("#templateField_"+b+"_form .extra").hide();$("#templateField_"+b+"_form ."+a.toLowerCase()+"_options").show()}function showHideEmpty(a){if($(a+" li:not(.empty)").length==0){$(a+" .empty").show()}else{$(a+" .empty").hide()}}function showWaiting(){$(".wait").show()}function hideWaiting(){$(".wait").hide()}function openOntologyDialog(){$("#ontologyDialog").dialog("open")}function addOntology(){var a;var b;a=baseUrl+"/templateEditor/addOntologyById";if($("#ontologyAcronym").val()){b="ontology_id="+$("#addOntology input[name=ontologyAcronym-ontology_id]").val();$("#ncbo_spinner").show()}else{b="ontology_id="+$("#addOntology input[name=termID-ontology_id]").val();$("#term_spinner").show()}$.ajax({url:a,data:b,dataType:"json",type:"POST",success:function(d,e,c){updateOntologyLists(d);$("#term_spinner").hide();$("#ncbo_spinner").hide();$("#ontologyDialog").dialog("close")},error:function(c){alert("Could not add ontology: "+c.responseText);$("#term_spinner").hide();$("#ncbo_spinner").hide();$("#ontologyDialog").dialog("close")}})}function updateOntologyLists(a){if($("#selectedTemplateFields :not(.ui-state-disabled) option[value="+a.id+"]").length<=0){$(".ontologySelect").append('<option title="'+a.name+'" value="'+a.id+'">'+a.name+"</option>")}else{userMessage("This ontology is already added.")}}function deleteOntology(a){$("#ontologies_"+a).children().remove(":selected")};